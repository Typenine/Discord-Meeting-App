{
  "version": 3,
  "sources": ["../bundle-sPLjJr/strip-cf-connecting-ip-header.js", "../../../src/index.mjs", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-sPLjJr/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-sPLjJr/middleware-loader.entry.ts"],
  "sourceRoot": "/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/.wrangler/tmp/dev-qck5Vq",
  "sourcesContent": ["function stripCfConnectingIPHeader(input, init) {\n\tconst request = new Request(input, init);\n\trequest.headers.delete(\"CF-Connecting-IP\");\n\treturn request;\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\treturn Reflect.apply(target, thisArg, [\n\t\t\tstripCfConnectingIPHeader.apply(null, argArray),\n\t\t]);\n\t},\n});\n", "// Cloudflare Worker + Durable Object backend for Discord Agenda Activity\n// Supports both Discord Activity mode and standalone room + hostKey mode\n\n// ---- CORS helpers ----\n\n// Check if origin is allowed\nfunction isAllowedOrigin(origin) {\n  if (!origin) return false;\n  \n  // Allow Vercel deployments\n  if (origin.endsWith('.vercel.app')) return true;\n  \n  // Allow localhost for development\n  if (origin === 'http://localhost:5173') return true;\n  if (origin === 'http://localhost:3000') return true;\n  if (origin === 'http://localhost:8787') return true;\n  \n  return false;\n}\n\n// Get CORS headers for a given request\nfunction getCorsHeaders(request) {\n  const origin = request.headers.get('Origin');\n  \n  // If no origin header, don't set CORS headers\n  if (!origin) return {};\n  \n  // Check if origin is allowed\n  if (!isAllowedOrigin(origin)) return {};\n  \n  return {\n    'Access-Control-Allow-Origin': origin,\n    'Access-Control-Allow-Methods': 'GET,POST,PUT,PATCH,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n    'Access-Control-Max-Age': '86400',\n  };\n}\n\n// Wrap a response with CORS headers\nfunction withCors(response, request) {\n  const corsHeaders = getCorsHeaders(request);\n  \n  // If no CORS headers needed, return response as-is\n  if (Object.keys(corsHeaders).length === 0) return response;\n  \n  // Clone the response and add CORS headers\n  const newHeaders = new Headers(response.headers);\n  for (const [key, value] of Object.entries(corsHeaders)) {\n    newHeaders.set(key, value);\n  }\n  \n  return new Response(response.body, {\n    status: response.status,\n    statusText: response.statusText,\n    headers: newHeaders,\n  });\n}\n\n// Generate a random room ID (6 characters, alphanumeric)\nfunction generateRoomId() {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  let result = '';\n  for (let i = 0; i < 6; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\n// Generate a secure hostKey (16 characters, base64-like)\nfunction generateHostKey() {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < 16; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\nfunction parseHostConfig(raw) {\n  const parts = String(raw || \"\")\n    .split(\",\")\n    .map((s) => s.trim())\n    .filter(Boolean);\n\n  const allowAll = parts.includes(\"*\");\n  const ids = new Set(parts.filter((id) => id !== \"*\"));\n\n  return { allowAll, ids };\n}\n\nfunction isAllowedHost(userId, hostConfig) {\n  if (!userId) return false;\n  if (!hostConfig) return false;\n  if (hostConfig.allowAll) return true;\n  const u = String(userId).trim();\n  return hostConfig.ids.has(u);\n}\n\nfunction jsonResponse(body, status = 200, extraHeaders = {}) {\n  return new Response(JSON.stringify(body, null, 2), {\n    status,\n    headers: {\n      \"Content-Type\": \"application/json; charset=utf-8\",\n      ...extraHeaders,\n    },\n  });\n}\n\n// ---- Meeting state helpers (ported from server/src/meeting.js) ----\n\nfunction createMeetingSession({ sessionId, hostKey = null, hostKeyFallback = null }) {\n  return {\n    sessionId,\n    hostUserId: null,\n    hostKey, // For standalone room mode (null for Discord Activity mode)\n    hostKeyFallback, // For Discord Activity mode: optional hostKey for testing without Discord OAuth\n    agenda: [],\n    activeAgendaId: null,\n    timer: {\n      running: false,\n      endsAtMs: null, // Authoritative absolute end time (when running)\n      durationSec: 0, // Duration for current agenda item\n      pausedRemainingSec: null, // Remaining seconds when paused\n      updatedAtMs: Date.now(), // Server timestamp of last timer state change\n    },\n    vote: {\n      open: false,\n      question: \"\",\n      options: [], // Array<{ id, label }>\n      votesByClientId: {}, // { [clientId]: optionId }\n      closedResults: [], // history\n    },\n    attendance: {}, // { [userId]: { displayName, joinedAt } }\n    log: [],\n  };\n}\n\nfunction snapshot(session) {\n  return JSON.parse(JSON.stringify(session));\n}\n\nfunction getActiveItem(session) {\n  return session.agenda.find((a) => a.id === session.activeAgendaId) ?? null;\n}\n\nfunction setActiveItem(session, agendaId) {\n  const exists = session.agenda.some((a) => a.id === agendaId);\n  if (!exists) return false;\n  session.activeAgendaId = agendaId;\n\n  // ALWAYS reset timer when changing active item (per requirements)\n  const item = getActiveItem(session);\n  if (item) {\n    session.timer.running = false;\n    session.timer.endsAtMs = null;\n    session.timer.pausedRemainingSec = null;\n    session.timer.durationSec = item.durationSec || 0;\n    session.timer.updatedAtMs = Date.now();\n  }\n\n  return true;\n}\n\nfunction nextAgendaItem(session) {\n  if (session.agenda.length === 0) return false;\n  \n  const currentIndex = session.agenda.findIndex((a) => a.id === session.activeAgendaId);\n  const nextIndex = (currentIndex + 1) % session.agenda.length;\n  const nextItem = session.agenda[nextIndex];\n  \n  if (nextItem) {\n    return setActiveItem(session, nextItem.id);\n  }\n  return false;\n}\n\nfunction prevAgendaItem(session) {\n  if (session.agenda.length === 0) return false;\n  \n  const currentIndex = session.agenda.findIndex((a) => a.id === session.activeAgendaId);\n  const prevIndex = currentIndex <= 0 ? session.agenda.length - 1 : currentIndex - 1;\n  const prevItem = session.agenda[prevIndex];\n  \n  if (prevItem) {\n    return setActiveItem(session, prevItem.id);\n  }\n  return false;\n}\n\nfunction timerStart(session) {\n  if (session.timer.running) return;\n  const serverNowMs = Date.now();\n  session.timer.running = true;\n  session.timer.endsAtMs = serverNowMs + session.timer.durationSec * 1000;\n  session.timer.pausedRemainingSec = null;\n  session.timer.updatedAtMs = serverNowMs;\n}\n\nfunction timerPause(session) {\n  if (!session.timer.running) return;\n  const serverNowMs = Date.now();\n  const remainingMs = Math.max(0, session.timer.endsAtMs - serverNowMs);\n  session.timer.pausedRemainingSec = Math.ceil(remainingMs / 1000);\n  session.timer.running = false;\n  session.timer.endsAtMs = null;\n  session.timer.updatedAtMs = serverNowMs;\n}\n\nfunction timerResume(session) {\n  if (session.timer.running) return;\n  if (session.timer.pausedRemainingSec === null) return;\n  const serverNowMs = Date.now();\n  session.timer.running = true;\n  session.timer.endsAtMs = serverNowMs + session.timer.pausedRemainingSec * 1000;\n  session.timer.pausedRemainingSec = null;\n  session.timer.updatedAtMs = serverNowMs;\n}\n\nfunction timerReset(session) {\n  const serverNowMs = Date.now();\n  session.timer.running = false;\n  session.timer.endsAtMs = null;\n  session.timer.pausedRemainingSec = null;\n  // Keep durationSec as is (from active agenda item)\n  session.timer.updatedAtMs = serverNowMs;\n}\n\nfunction timerResetToActiveItem(session) {\n  const item = getActiveItem(session);\n  const sec = item ? (item.durationSec || 0) : 0;\n  const serverNowMs = Date.now();\n  session.timer.running = false;\n  session.timer.endsAtMs = null;\n  session.timer.pausedRemainingSec = null;\n  session.timer.durationSec = sec;\n  session.timer.updatedAtMs = serverNowMs;\n}\n\nfunction openVote(session, { question, options }) {\n  session.vote.open = true;\n  session.vote.question = question;\n  // Convert options to structured format: [{ id, label }]\n  // If options are already objects with id, keep them; otherwise generate ids\n  session.vote.options = options.map((opt, idx) => {\n    if (typeof opt === 'object' && opt.id && opt.label) {\n      return opt;\n    }\n    // Convert string to object with generated id\n    const label = typeof opt === 'string' ? opt : String(opt);\n    return { id: `opt${idx + 1}`, label };\n  });\n  session.vote.votesByClientId = {};\n}\n\nfunction castVote(session, { userId, optionId }) {\n  if (!session.vote.open) return false;\n  // Find option by id\n  const optionExists = session.vote.options.some(opt => opt.id === optionId);\n  if (!optionExists) return false;\n  session.vote.votesByClientId[userId] = optionId;\n  return true;\n}\n\nfunction closeVote(session) {\n  if (!session.vote.open) return null;\n\n  // Count votes by option id\n  const tally = {};\n  session.vote.options.forEach(opt => {\n    tally[opt.id] = 0;\n  });\n  \n  for (const optionId of Object.values(session.vote.votesByClientId)) {\n    if (tally[optionId] !== undefined) {\n      tally[optionId] += 1;\n    }\n  }\n\n  const result = {\n    ts: Date.now(),\n    agendaId: session.activeAgendaId,\n    question: session.vote.question,\n    options: session.vote.options, // Keep structured options\n    tally, // { [optionId]: count }\n    totalVotes: Object.keys(session.vote.votesByClientId).length,\n  };\n\n  session.vote.closedResults.push(result);\n  session.vote.open = false;\n  session.vote.question = \"\";\n  session.vote.options = [];\n  session.vote.votesByClientId = {};\n\n  session.log.push({ ts: Date.now(), type: \"VOTE_CLOSED\", result });\n  return result;\n}\n\nasync function handleToken(request, env) {\n  const url = new URL(request.url);\n  let status = 500;\n\n  console.log(\"[/api/token] request\", { path: url.pathname, search: url.search });\n\n  let body;\n  try {\n    body = await request.json();\n  } catch (err) {\n    console.error(\"[/api/token] JSON parse error\", String(err));\n    status = 400;\n    const resp = jsonResponse({ error: \"invalid_json\", details: \"Request body must be JSON with { code }\" }, status);\n    console.log(\"[/api/token] response\", { path: url.pathname, status });\n    return resp;\n  }\n\n  const code = body?.code;\n  if (!code) {\n    status = 400;\n    const resp = jsonResponse({ error: \"missing_code\" }, status);\n    console.log(\"[/api/token] response\", { path: url.pathname, status });\n    return resp;\n  }\n\n  const clientId = env.DISCORD_CLIENT_ID;\n  const clientSecret = env.DISCORD_CLIENT_SECRET;\n  const redirectUri = env.DISCORD_REDIRECT_URI;\n\n  if (!clientId || !clientSecret || !redirectUri) {\n    status = 500;\n    const resp = jsonResponse({ error: \"server_misconfigured\" }, status);\n    console.log(\"[/api/token] response\", { path: url.pathname, status });\n    return resp;\n  }\n\n  const params = new URLSearchParams({\n    client_id: clientId,\n    client_secret: clientSecret,\n    grant_type: \"authorization_code\",\n    code,\n    // Must match EXACTLY what Discord uses for the OAuth redirect.\n    redirect_uri: redirectUri,\n  });\n\n  try {\n    const discordResp = await fetch(\"https://discord.com/api/oauth2/token\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n      body: params,\n    });\n\n    const text = await discordResp.text();\n    let data;\n    try {\n      data = text ? JSON.parse(text) : {};\n    } catch (err) {\n      console.error(\"[/api/token] Discord JSON parse error\", String(err));\n      data = { raw: text ?? null };\n    }\n\n    status = discordResp.status;\n\n    if (discordResp.ok && data && data.access_token) {\n      console.log(\"[/api/token] success\", { status });\n      const resp = jsonResponse({ access_token: data.access_token }, 200);\n      console.log(\"[/api/token] response\", { path: url.pathname, status: 200 });\n      return resp;\n    }\n\n    console.warn(\"[/api/token] failure\", { status, data });\n    const errorStatus = discordResp.status === 400 ? 400 : 502;\n    const resp = jsonResponse(\n      {\n        error: \"token_exchange_failed\",\n        details: { status: discordResp.status, body: data },\n      },\n      errorStatus,\n    );\n    console.log(\"[/api/token] response\", { path: url.pathname, status: errorStatus });\n    return resp;\n  } catch (err) {\n    console.error(\"[/api/token] exception\", String(err));\n    status = 500;\n    const resp = jsonResponse({ error: \"token_exchange_exception\", details: String(err) }, status);\n    console.log(\"[/api/token] response\", { path: url.pathname, status });\n    return resp;\n  }\n}\n\nexport default {\n  async fetch(request, env, ctx) {\n    const url = new URL(request.url);\n    const { pathname } = url;\n\n    // Handle OPTIONS preflight requests for all /api/* endpoints\n    if (request.method === \"OPTIONS\" && pathname.startsWith(\"/api/\")) {\n      return withCors(\n        new Response(null, { \n          status: 204,\n          headers: {\n            'Content-Length': '0',\n          },\n        }),\n        request\n      );\n    }\n\n    if (pathname === \"/health\" || pathname === \"/api/health\") {\n      const hostConfig = parseHostConfig(env.HOST_USER_IDS);\n      return withCors(\n        jsonResponse({\n          ok: true,\n          clientId: env.DISCORD_CLIENT_ID || null,\n          redirectUri: env.DISCORD_REDIRECT_URI || null,\n          hostAllowAll: hostConfig.allowAll,\n          hostIdsCount: hostConfig.ids.size,\n        }),\n        request\n      );\n    }\n\n    if (pathname === \"/api/token\" && request.method === \"POST\") {\n      const response = await handleToken(request, env);\n      return withCors(response, request);\n    }\n\n    // Create new standalone room\n    if (pathname === \"/api/room/create\" && request.method === \"POST\") {\n      const roomId = generateRoomId();\n      const hostKey = generateHostKey();\n      \n      return withCors(\n        jsonResponse({\n          roomId,\n          hostKey,\n          viewerUrl: `${url.origin}/?room=${roomId}`,\n          hostUrl: `${url.origin}/?room=${roomId}&hostKey=${hostKey}`,\n        }),\n        request\n      );\n    }\n\n    if (pathname === \"/api/ws\" && request.headers.get(\"Upgrade\") === \"websocket\") {\n      const room = url.searchParams.get(\"room\") || \"default\";\n      const id = env.MEETING_ROOM.idFromName(room);\n      const stub = env.MEETING_ROOM.get(id);\n\n      const wsRequest = new Request(request, {\n        headers: new Headers([\n          ...request.headers,\n          [\"X-Room-Id\", room],\n        ]),\n      });\n\n      return stub.fetch(wsRequest);\n    }\n\n    return withCors(\n      jsonResponse({ error: \"not_found\", path: pathname }, 404),\n      request\n    );\n  },\n};\n\nexport class MeetingRoom {\n  constructor(state, env) {\n    this.state = state;\n    this.env = env;\n    this.sockets = new Set();\n    this.metadata = new Map(); // ws -> { sessionId, clientId, userId, hostKey, clientTimeOffset }\n    this.session = null;\n    this.hostConfig = parseHostConfig(env.HOST_USER_IDS);\n    // Vote batching to prevent broadcast storms with 10-15 users\n    this.voteBatchTimer = null;\n    this.voteBatchPending = false;\n  }\n\n  async fetch(request) {\n    if (request.headers.get(\"Upgrade\") === \"websocket\") {\n      const pair = new WebSocketPair();\n      const [client, server] = Object.values(pair);\n      this.handleWebSocket(server, request);\n      return new Response(null, { status: 101, webSocket: client });\n    }\n\n    return jsonResponse({ error: \"not_found_in_durable_object\" }, 404);\n  }\n\n  getOrCreateSession(sessionId, hostKey = null, hostKeyFallback = null) {\n    if (!this.session) {\n      const id = sessionId || \"default\";\n      this.session = createMeetingSession({ sessionId: id, hostKey, hostKeyFallback });\n    }\n    return this.session;\n  }\n\n  // Validate host access: supports both standalone (hostKey) and Discord Activity mode (userId/allowlist)\n  // For Discord Activity mode, also accepts hostKey as fallback (for testing without Discord OAuth)\n  validateHostAccess(clientId, providedHostKey) {\n    if (!this.session) return false;\n    \n    // Standalone room mode: check hostKey\n    if (this.session.hostKey) {\n      return providedHostKey === this.session.hostKey;\n    }\n    \n    // Discord Activity mode: check userId/clientId match\n    if (this.session.hostUserId === clientId) {\n      return true;\n    }\n    \n    // Discord Activity mode fallback: if hostKey was provided, check against stored hostKey\n    // This allows testing Discord Activity UI without Discord OAuth by using hostKey\n    if (providedHostKey && this.session.hostKeyFallback) {\n      return providedHostKey === this.session.hostKeyFallback;\n    }\n    \n    return false;\n  }\n\n  // Timer loop removed - no server-side ticking needed\n  // Clients render countdown locally using endsAtMs and serverOffset\n\n  broadcastState() {\n    if (!this.session) return;\n    const state = snapshot(this.session);\n    // Remove hostKey from broadcast for security\n    const safeState = { ...state };\n    delete safeState.hostKey;\n    const payload = JSON.stringify({ \n      type: \"STATE\", \n      state: safeState,\n      serverNow: Date.now(),\n    });\n    for (const ws of this.sockets) {\n      try {\n        ws.send(payload);\n      } catch (e) {\n        console.warn(\"[WS] broadcast send failed\", String(e));\n      }\n    }\n  }\n\n  // Batched broadcast for vote casts to prevent storms with 10-15 users\n  // Aggregates multiple vote casts over 500ms window into single broadcast\n  batchedBroadcastState() {\n    // Clear any existing timer\n    if (this.voteBatchTimer) {\n      clearTimeout(this.voteBatchTimer);\n    }\n    \n    this.voteBatchPending = true;\n    \n    // Batch for 500ms - aggregates multiple votes into one broadcast\n    this.voteBatchTimer = setTimeout(() => {\n      this.voteBatchPending = false;\n      this.voteBatchTimer = null;\n      this.broadcastState();\n    }, 500);\n  }\n\n  handleWebSocket(ws, request) {\n    const url = new URL(request.url);\n    const room = url.searchParams.get(\"room\") || request.headers.get(\"X-Room-Id\") || \"default\";\n\n    ws.accept();\n    this.sockets.add(ws);\n\n    ws.addEventListener(\"message\", (event) => {\n      let msg;\n      try {\n        msg = JSON.parse(event.data);\n      } catch (err) {\n        console.warn(\"[WS] invalid JSON\", String(err));\n        return;\n      }\n\n      // Handle TIME_PING for clock offset calibration\n      if (msg && msg.type === \"TIME_PING\") {\n        const serverNow = Date.now();\n        ws.send(JSON.stringify({ \n          type: \"TIME_PONG\", \n          clientSentAt: msg.clientSentAt,\n          serverNow,\n        }));\n        return;\n      }\n\n      if (msg && msg.type === \"HELLO\") {\n        console.log(\"[WS HELLO payload]\", JSON.stringify(msg, null, 2));\n\n        // New structure: { type:\"HELLO\", roomId, clientId, hostKey?, displayName }\n        // Also support old structure for Discord Activity mode\n        let clientId = msg.clientId;\n        let hostKey = msg.hostKey || null;\n        let displayName = msg.displayName || msg.username || \"Guest\";\n        let roomId = msg.roomId || msg.sessionId || room;\n\n        // Discord Activity mode: extract userId from SDK payload (for backward compatibility)\n        let discordUserId = null;\n        if (msg.userId != null) {\n          discordUserId = msg.userId;\n        } else if (msg.user && msg.user.id != null) {\n          discordUserId = msg.user.id;\n        } else if (msg.user && msg.user.user && msg.user.user.id != null) {\n          discordUserId = msg.user.user.id;\n        }\n\n        // Determine the identifier to use (prefer clientId, fall back to discordUserId)\n        const identifier = clientId || discordUserId;\n        \n        if (!identifier || !roomId) {\n          console.warn(\"[WS HELLO] missing clientId/userId or roomId\", { clientId, discordUserId, roomId });\n          return;\n        }\n\n        // For Discord Activity mode, check if user is allowed to be host\n        const allowed = discordUserId ? isAllowedHost(discordUserId, this.hostConfig) : false;\n        \n        // If not standalone mode (no hostKey in URL) but hostKey provided, use it as fallback\n        // This allows testing Discord Activity mode without Discord OAuth\n        const hostKeyFallback = (!hostKey && msg.hostKey) ? msg.hostKey : null;\n        \n        const session = this.getOrCreateSession(roomId, hostKey, hostKeyFallback);\n\n        // Set host based on mode\n        if (!session.hostUserId) {\n          if (session.hostKey) {\n            // Standalone mode: host is whoever has the hostKey\n            if (hostKey === session.hostKey) {\n              session.hostUserId = identifier;\n              session.log.push({ ts: Date.now(), type: \"HOST_SET\", clientId: identifier, mode: \"standalone\" });\n              console.log(\"[HOST_SET] standalone mode\", { sessionId: roomId, hostUserId: session.hostUserId });\n            }\n          } else if (allowed && discordUserId) {\n            // Discord Activity mode: host is first allowed user (via allowlist)\n            session.hostUserId = discordUserId;\n            session.log.push({ ts: Date.now(), type: \"HOST_SET\", userId: discordUserId, mode: \"discord_allowlist\" });\n            console.log(\"[HOST_SET] discord mode via allowlist\", { sessionId: roomId, hostUserId: session.hostUserId });\n          } else if (!allowed && hostKeyFallback) {\n            // Discord Activity mode fallback: if allowlist doesn't match but hostKey provided, set hostKeyFallback\n            // This enables testing Discord Activity UI without Discord OAuth\n            if (!session.hostKeyFallback) {\n              session.hostKeyFallback = hostKeyFallback;\n              session.hostUserId = identifier;\n              session.log.push({ ts: Date.now(), type: \"HOST_SET\", clientId: identifier, mode: \"discord_hostkey_fallback\" });\n              console.log(\"[HOST_SET] discord mode via hostKey fallback\", { sessionId: roomId, hostUserId: session.hostUserId });\n            }\n          }\n        }\n\n        // Add to attendance using clientId\n        if (!session.attendance[identifier]) {\n          session.attendance[identifier] = {\n            clientId: identifier,\n            userId: discordUserId, // Keep discordUserId for backward compatibility\n            displayName,\n            joinedAt: Date.now(),\n          };\n        }\n\n        // Determine isHost: check standalone hostKey, Discord Activity userId, or hostKeyFallback\n        const isHost = session.hostKey \n          ? (hostKey === session.hostKey)\n          : (session.hostUserId === identifier || \n             (hostKeyFallback && session.hostKeyFallback === hostKeyFallback));\n\n        this.metadata.set(ws, { \n          sessionId: roomId, \n          clientId: identifier, \n          userId: discordUserId, \n          hostKey: hostKey || hostKeyFallback, \n          clientTimeOffset: 0 \n        });\n\n        console.log(\"[WS HELLO resolved]\", {\n          sessionId: roomId,\n          clientId: identifier,\n          discordUserId,\n          isHost,\n          mode: session.hostKey ? \"standalone\" : \"discord\",\n          hostKeyFallback: !!session.hostKeyFallback,\n        });\n\n        ws.send(JSON.stringify({ \n          type: \"HELLO_ACK\", \n          isHost,\n          serverNow: Date.now(),\n        }));\n        this.broadcastState();\n        return;\n      }\n\n      const meta = this.metadata.get(ws);\n      if (!meta) return;\n\n      const session = this.getOrCreateSession(meta.sessionId);\n      const isHost = this.validateHostAccess(meta.clientId, meta.hostKey);\n\n      // Non-host actions\n      if (!isHost) {\n        if (msg.type === \"VOTE_CAST\") {\n          const ok = castVote(session, { userId: meta.clientId, optionId: msg.optionId });\n          // Use batched broadcast to prevent storms with 10-15 users voting simultaneously\n          if (ok) this.batchedBroadcastState();\n        } else {\n          ws.send(\n            JSON.stringify({ type: \"ERROR\", error: \"not_host\", attempted: msg.type ?? null }),\n          );\n        }\n        return;\n      }\n\n      // Host-only actions\n      switch (msg.type) {\n        case \"AGENDA_ADD\":\n          if (typeof msg.title === \"string\") {\n            const id = `a${Date.now()}_${Math.random().toString(36).substring(2, 7)}`;\n            const durationSec = Number(msg.durationSec) || 0;\n            session.agenda.push({\n              id,\n              title: msg.title,\n              durationSec: durationSec,\n              notes: msg.notes || \"\",\n            });\n            // If first item, make it active and set timer duration\n            if (session.agenda.length === 1) {\n              session.activeAgendaId = id;\n              session.timer.durationSec = durationSec;\n              session.timer.updatedAtMs = Date.now();\n            }\n            this.broadcastState();\n          }\n          break;\n        case \"AGENDA_UPDATE\":\n          {\n            const item = session.agenda.find((a) => a.id === msg.agendaId);\n            if (item) {\n              if (msg.title !== undefined) item.title = msg.title;\n              if (msg.durationSec !== undefined) item.durationSec = Number(msg.durationSec) || 0;\n              if (msg.notes !== undefined) item.notes = msg.notes;\n              this.broadcastState();\n            }\n          }\n          break;\n        case \"AGENDA_DELETE\":\n          {\n            const idx = session.agenda.findIndex((a) => a.id === msg.agendaId);\n            if (idx >= 0) {\n              session.agenda.splice(idx, 1);\n              if (session.activeAgendaId === msg.agendaId) {\n                session.activeAgendaId = session.agenda.length ? session.agenda[0].id : null;\n                const serverNowMs = Date.now();\n                session.timer.running = false;\n                session.timer.endsAtMs = null;\n                session.timer.pausedRemainingSec = null;\n                session.timer.durationSec = 0;\n                session.timer.updatedAtMs = serverNowMs;\n              }\n              this.broadcastState();\n            }\n          }\n          break;\n        case \"AGENDA_SET_ACTIVE\":\n          if (setActiveItem(session, msg.agendaId)) this.broadcastState();\n          break;\n        case \"AGENDA_NEXT\":\n          if (nextAgendaItem(session)) this.broadcastState();\n          break;\n        case \"AGENDA_PREV\":\n          if (prevAgendaItem(session)) this.broadcastState();\n          break;\n        case \"TIMER_START\":\n          timerStart(session);\n          this.broadcastState();\n          break;\n        case \"TIMER_PAUSE\":\n          timerPause(session);\n          this.broadcastState();\n          break;\n        case \"TIMER_RESUME\":\n          timerResume(session);\n          this.broadcastState();\n          break;\n        case \"TIMER_RESET\":\n          timerResetToActiveItem(session);\n          this.broadcastState();\n          break;\n        case \"TIMER_EXTEND\":\n          if (typeof msg.seconds === \"number\") {\n            const serverNowMs = Date.now();\n            if (session.timer.running && session.timer.endsAtMs != null) {\n              // Extend running timer\n              session.timer.endsAtMs += msg.seconds * 1000;\n              session.timer.updatedAtMs = serverNowMs;\n            } else if (session.timer.pausedRemainingSec !== null) {\n              // Extend paused timer\n              session.timer.pausedRemainingSec = Math.max(0, session.timer.pausedRemainingSec + msg.seconds);\n              session.timer.updatedAtMs = serverNowMs;\n            } else {\n              // Extend duration for stopped timer\n              session.timer.durationSec = Math.max(0, session.timer.durationSec + msg.seconds);\n              session.timer.updatedAtMs = serverNowMs;\n            }\n            this.broadcastState();\n          }\n          break;\n        case \"VOTE_OPEN\":\n          if (\n            typeof msg.question === \"string\" &&\n            Array.isArray(msg.options) &&\n            msg.options.length >= 2\n          ) {\n            openVote(session, { question: msg.question, options: msg.options });\n            this.broadcastState();\n          }\n          break;\n        case \"VOTE_CLOSE\":\n          closeVote(session);\n          this.broadcastState();\n          break;\n        default:\n          break;\n      }\n    });\n\n    ws.addEventListener(\"close\", (event) => {\n      console.log(\"[WS] closed\", {\n        code: event.code,\n        reason: event.reason,\n        wasClean: event.wasClean,\n      });\n      this.sockets.delete(ws);\n      this.metadata.delete(ws);\n    });\n\n    ws.addEventListener(\"error\", (event) => {\n      console.warn(\"[WS] error\", event?.message || String(event));\n    });\n  }\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/src/index.mjs\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/src/index.mjs\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/.wrangler/tmp/bundle-sPLjJr/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/.wrangler/tmp/bundle-sPLjJr/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/home/runner/work/Discord-Meeting-App/Discord-Meeting-App/worker/.wrangler/tmp/bundle-sPLjJr/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["resp", "session", "isHost"]
}
